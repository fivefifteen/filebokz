{"version":3,"file":"filebokz.js","sources":["../src/filebokz.js"],"sourcesContent":["/*!\n  filebokz v0.2.0 (https://filebokz.js.org)\n  by Five Fifteen (https://fivefifteen.com)\n*/\n\nconst filebokz = (elements, applyClass) => {\n  if (!elements) elements = '.filebokz'\n  if (typeof applyClass !== 'string') applyClass = 'filebokz'\n\n  const imageTypes = ['apng', 'bmp', 'gif', 'x-icon', 'jpeg', 'png', 'svg+xml', 'tiff', 'webp']\n  const sizeUnits = ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n  const div = document.createElement('div')\n  const draggable = ('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)\n  const advanced = ('FormData' in window && 'FileReader' in window)\n\n  if (!filebokz.count) filebokz.count = 0\n\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements)\n  } else if (elements instanceof HTMLElement) {\n    elements = [elements]\n  }\n\n  const displayErrorMessage = (fileBox, errorType, variable) => {\n    const element = fileBox.querySelector('.error-msg')\n    const errorDisplayDuration = fileBox.dataset.errorDisplayDuration || 3000\n\n    fileBox.classList.add('error')\n\n    const fileBoxData = fileBox.dataset\n    let message = ''\n\n    if (errorType === 'maxFiles') {\n      message = fileBoxData.maxFilesErrorMsg || 'A maximum of {variable} file{s} can be uploaded.'\n      message = message.replace(/{variable}/ig, variable)\n      message = message.replace(/{s}/ig, (variable > 1) ? 's' : '')\n    }\n\n    if (errorType === 'maxFileSize') {\n      message = fileBoxData.maxFileSizeErrorMsg || 'File size cannot exceed {variable}.'\n      message = message.replace(/{variable}/ig, fileSize(variable))\n    }\n\n    if (errorType === 'maxSize') {\n      message = fileBoxData.maxSizeErrorMsg || 'Total combined file size cannot exceed {variable}.'\n      message = message.replace(/{variable}/ig, fileSize(variable))\n    }\n\n    if (errorType === 'allowedExtensions') {\n      message = fileBoxData.allowedExtensionsErrorMsg || 'Only the following file types are allowed: {variable}.'\n      message = message.replace(/{variable}/ig, variable)\n    }\n\n    if (element) {\n      element.innerHTML = message\n\n      let errorAnimationDuration = 250\n      if (Object.prototype.hasOwnProperty.call(fileBox.dataset, 'errorAnimationDuration')) {\n        errorAnimationDuration = fileBox.dataset.errorAnimationDuration\n      }\n\n      setTimeout(function () {\n        element.innerHTML = ''\n      }, errorDisplayDuration + errorAnimationDuration)\n    }\n\n    setTimeout(function () {\n      fileBox.classList.remove('error')\n    }, errorDisplayDuration)\n\n    filebokz.triggerEvent('error', fileBox, {\n      errorMessage: message,\n      errorType\n    })\n  }\n\n  const fileAttribute = (attributes, attrPrefix, typePrefix, typeKey) => {\n    if (Object.prototype.hasOwnProperty.call(attributes, attrPrefix + typeKey)) {\n      return attributes[attrPrefix + typeKey]\n    } else if (Object.prototype.hasOwnProperty.call(attributes, attrPrefix + typePrefix)) {\n      return attributes[attrPrefix + typePrefix]\n    }\n  }\n\n  const fileSize = (bytes) => {\n    if (Math.abs(bytes) < 1024) return bytes + ' B'\n\n    let u = -1\n\n    do {\n      bytes /= 1024\n      ++u\n    } while (Math.round(Math.abs(bytes) * 10) / 10 >= 1024 && u < sizeUnits.length - 1)\n\n    return +bytes.toFixed(1) + ' ' + sizeUnits[u]\n  }\n\n  const onBlur = (e, fileBox) => {\n    fileBox.classList.remove('in-focus')\n  }\n\n  const onChange = (e, fileBox, input) => {\n    let files = input.files\n    const originalFiles = input.originalFiles || []\n    const removing = e.filebokzAction === 'remove'\n\n    if (files.length) {\n      const appendable = !fileBox.dataset.appendable || fileBox.dataset.appendable.toLowerCase() !== 'false'\n      const multiple = input.hasAttribute('multiple') && input.getAttribute('multiple').toLowerCase() !== 'false'\n\n      if (appendable && multiple && !removing && originalFiles.length) {\n        const filesArr = Array.from(files)\n        const newFilesArr = Array.from(originalFiles)\n\n        for (let i = 0; i < filesArr.length; i++) {\n          let duplicateFound = false\n\n          for (let k = 0; k < newFilesArr.length; k++) {\n            if (\n              filesArr[i].lastModifed === newFilesArr[k].lastModifed &&\n              filesArr[i].name === newFilesArr[k].name &&\n              filesArr[i].size === newFilesArr[k].size &&\n              filesArr[i].type === newFilesArr[k].type\n            ) duplicateFound = true\n          }\n\n          if (!duplicateFound) newFilesArr.push(filesArr[i])\n        }\n\n        input.files = filebokz.newFileList(newFilesArr)\n        files = input.files\n      }\n\n      if (validateFiles(files, fileBox, input)) {\n        fileBox.classList.add('has-files')\n      } else {\n        files = []\n      }\n    }\n\n    if (!files.length && !removing) {\n      input.files = filebokz.newFileList(originalFiles)\n      files = input.files\n    }\n\n    if (!files.length) {\n      fileBox.classList.remove('has-files')\n    }\n\n    input.originalFiles = files\n    fileBox.dataset.fileCount = files.length\n\n    const fileCountElement = fileBox.querySelector('.file-count')\n    if (fileCountElement) fileCountElement.innerHTML = files.length\n\n    let size = 0\n    for (let s = 0; s < files.length; s++) {\n      size += files[s].size\n    }\n\n    fileBox.dataset.size = size\n\n    const sizeElement = fileBox.querySelector('.size')\n    if (sizeElement) sizeElement.innerHTML = fileSize(size)\n\n    const filesElement = fileBox.querySelector('.files')\n    if (filesElement) {\n      const filesElementData = filesElement.dataset\n\n      const fileElements = filesElement.querySelectorAll('.file')\n      if (fileElements) {\n        for (let fe = 0; fe < fileElements.length; fe++) {\n          filesElement.removeChild(fileElements[fe])\n        }\n      }\n\n      if (files.length) {\n        const draggableFiles = !filesElementData.draggable || filesElementData.draggable.toLowerCase() !== 'false'\n\n        for (let f = 0; f < files.length; f++) {\n          (function (file, index) {\n            let typePrefix = file.type.split('/')[0]\n            const typeKey = file.type\n              .replace(/[/+-](\\w{1})/g, function (c) { return c.toUpperCase() })\n              .replace(/[/+-]/g, '')\n\n            typePrefix = typePrefix.charAt(0).toUpperCase() + typePrefix.slice(1)\n\n            let element = fileAttribute(filesElementData, 'element', typePrefix, typeKey)\n            element = element || filesElementData.element || 'span'\n\n            let content = fileAttribute(filesElementData, 'content', typePrefix, typeKey)\n            content = content || filesElementData.content || '{name}'\n\n            let contentBefore = fileAttribute(filesElementData, 'contentBefore', typePrefix, typeKey)\n            contentBefore = contentBefore || filesElementData.contentBefore || ''\n\n            let contentAfter = fileAttribute(filesElementData, 'contentAfter', typePrefix, typeKey)\n            contentAfter = contentAfter || filesElementData.contentAfter || ''\n\n            let url = fileAttribute(filesElementData, 'url', typePrefix, typeKey)\n\n            if (!url) {\n              if (imageTypes.includes(file.type.replace('image/', ''))) {\n                url = window.URL.createObjectURL(file)\n              } else {\n                url = filesElementData.url || ''\n              }\n            }\n\n            content = contentBefore + content + contentAfter\n            content = content.replace(/{name}/ig, file.name)\n            content = content.replace(/{type}/ig, file.type)\n            content = content.replace(/{size}/ig, fileSize(file.size))\n            content = content.replace(/{url}/ig, url)\n\n            const fileElement = document.createElement(element)\n\n            fileElement.className = 'file'\n            fileElement.innerHTML = content\n\n            if (draggable && draggableFiles) {\n              fileElement.draggable = 'true'\n              fileElement.addEventListener('drag', function (e) { onFileDrag(e, fileBox.id) }, false)\n              fileElement.addEventListener('dragstart', function (e) { onFileDragStart(e, fileBox.id) }, false)\n            }\n\n            const removeElement = fileElement.querySelector('.remove')\n            if (removeElement) {\n              removeElement.addEventListener('click', function (e) { onFileRemoveClick(e, input, index) }, false)\n            }\n\n            filesElement.append(fileElement)\n          })(files[f], f)\n        }\n      }\n    }\n\n    if (files.length > originalFiles.length) {\n      filebokz.triggerEvent('file-added', fileBox)\n    } else if (files.length < originalFiles.length) {\n      filebokz.triggerEvent('file-removed', fileBox)\n    }\n  }\n\n  const onDragEnter = (e, fileBox, input) => {\n    e.preventDefault()\n    e.stopPropagation()\n    fileBox.classList.add('is-dragging')\n  }\n\n  const onDragLeave = (e, fileBox) => {\n    e.preventDefault()\n    e.stopPropagation()\n    fileBox.classList.remove('is-dragging')\n  }\n\n  const onDrop = (e, fileBox, input) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    fileBox.classList.remove('is-dragging')\n\n    let files = e.dataTransfer.files\n    const oldFileBoxId = e.dataTransfer.getData('fileBoxId')\n\n    if (oldFileBoxId) {\n      const oldFileIndex = e.dataTransfer.getData('fileIndex')\n      const oldFileBox = document.getElementById(oldFileBoxId)\n      const oldInput = oldFileBox.querySelector('input')\n      const oldFileElement = oldFileBox.querySelector('.files').children[oldFileIndex]\n\n      oldFileBox.classList.remove('is-dragging')\n      oldFileBox.classList.remove('is-removing')\n      oldFileBox.classList.remove('is-transferring')\n      oldFileElement.classList.remove('is-dragging')\n      oldFileElement.classList.remove('is-removing')\n      oldFileElement.classList.remove('is-transferring')\n\n      if (oldFileBoxId === fileBox.id) return\n\n      const oldFilesArr = Array.from(oldInput.files)\n      const file = oldFilesArr[oldFileIndex]\n      let filesArr = Array.from(input.files)\n      const multiple = input.hasAttribute('multiple') && input.getAttribute('multiple').toLowerCase() !== 'false'\n\n      if (multiple) {\n        filesArr.push(file)\n      } else {\n        filesArr = [file]\n      }\n\n      if (validateFiles(filesArr, fileBox, input)) {\n        files = filebokz.newFileList(filesArr)\n\n        oldFilesArr.splice(oldFileIndex, 1)\n        oldInput.files = filebokz.newFileList(oldFilesArr)\n\n        filebokz.triggerEvent('change', oldInput, { filebokzAction: 'remove' })\n      }\n    }\n\n    if (files && files.length) {\n      input.files = files\n      filebokz.triggerEvent('change', input)\n    }\n  }\n\n  const onFileDrag = (e, fileBoxId) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    const overElement = document.elementFromPoint(e.pageX, e.pageY)\n\n    if (overElement) {\n      const fileBox = document.getElementById(fileBoxId)\n      const newFileBox = overElement.closest('[filebokz-id]')\n\n      if (newFileBox && newFileBox.classList.contains('js-enabled')) {\n        if (newFileBox.id !== fileBoxId) {\n          e.target.classList.add('is-transferring')\n          fileBox.classList.add('is-transferring')\n        }\n\n        e.target.classList.remove('is-removing')\n        fileBox.classList.remove('is-removing')\n      } else {\n        e.target.classList.add('is-removing')\n        fileBox.classList.add('is-removing')\n        e.target.classList.remove('is-transferring')\n        fileBox.classList.remove('is-transferring')\n      }\n    }\n  }\n\n  const onFileDragStart = (e, fileBoxId, index) => {\n    e.target.classList.add('is-dragging')\n\n    const fileIndex = Array.from(e.target.parentNode.children).indexOf(e.target)\n\n    e.dataTransfer.setData('fileBoxId', fileBoxId)\n    e.dataTransfer.setData('fileIndex', fileIndex)\n  }\n\n  const onFileRemoveClick = (e, input, index) => {\n    e.preventDefault()\n    e.stopPropagation()\n    filebokz.removeFiles(input, index)\n  }\n\n  const onFocus = (e, fileBox) => {\n    fileBox.classList.add('in-focus')\n  }\n\n  const onReset = (e, fileBox, input) => {\n    const error = fileBox.querySelector('.error')\n    if (error) error.innerHTML = ''\n\n    fileBox.classList.remove('error')\n\n    filebokz.triggerEvent('change', input)\n  }\n\n  const onSubmit = (e, fileBox) => {\n    fileBox.classList.add('is-uploading')\n  }\n\n  const onWindowDragOver = (e) => {\n    e.preventDefault()\n  }\n\n  const onWindowDrop = (e) => {\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    const fileBoxId = e.dataTransfer.getData('fileBoxId')\n\n    if (fileBoxId) {\n      const fileBox = document.getElementById(fileBoxId)\n      const input = fileBox.querySelector('input')\n      const index = e.dataTransfer.getData('fileIndex')\n\n      filebokz.removeFiles(input, index)\n    }\n  }\n\n  const validateFiles = (fileList, fileBox, input) => {\n    const fileBoxData = fileBox.dataset\n    const multiple = input.hasAttribute('multiple') && input.getAttribute('multiple').toLowerCase() !== 'false'\n    const maxFiles = !multiple ? 1 : Object.prototype.hasOwnProperty.call(fileBoxData, 'maxFiles') ? fileBoxData.maxFiles : null\n    const maxFileSize = fileBoxData.maxFileSize\n    const maxSize = fileBoxData.maxSize\n    const allowedExtensions = fileBoxData.allowedExtensions ? fileBoxData.allowedExtensions.split(',').map(ext => ext.replace(/^(\\.)/, '')) : null\n    let size = 0\n\n    if (maxFiles && fileList.length > maxFiles) {\n      displayErrorMessage(fileBox, 'maxFiles', maxFiles)\n      return false\n    }\n\n    for (let i = 0; i < fileList.length; i++) {\n      let ext = fileList[i].name.split('.')\n\n      if (ext) {\n        ext = ext.pop().toLowerCase()\n      } else {\n        ext = '[none]'\n      }\n\n      size += fileList[i].size\n\n      if (maxFileSize && fileList[i].size > maxFileSize) {\n        displayErrorMessage(fileBox, 'maxFileSize', maxFileSize)\n        return false\n      }\n\n      if (maxSize && size > maxSize) {\n        displayErrorMessage(fileBox, 'maxSize', maxSize)\n        return false\n      }\n\n      if (allowedExtensions && !allowedExtensions.includes(ext)) {\n        displayErrorMessage(fileBox, 'allowedExtensions', allowedExtensions.join(', '))\n        return false\n      }\n    }\n\n    return true\n  }\n\n  for (let i = 0; i < elements.length; i++) {\n    (function (fileBox) {\n      const form = fileBox.closest('form')\n      const input = fileBox.querySelector('input[type=\"file\"]')\n\n      if (!input || fileBox.classList.contains('no-js') || Object.prototype.hasOwnProperty.call(fileBox.dataset, 'filebokzId')) return\n\n      filebokz.count++\n\n      fileBox.dataset.filebokzId = filebokz.count\n      fileBox.classList.add('js-enabled')\n\n      if (applyClass && !fileBox.classList.contains(applyClass)) fileBox.classList.add(applyClass)\n      if (advanced) fileBox.classList.add('is-advanced')\n      if (draggable) fileBox.classList.add('is-draggable')\n      if (!fileBox.id) fileBox.id = 'filebokz-' + filebokz.count\n\n      if (fileBox.dataset.allowedExtensions && !input.getAttribute('accept')) {\n        const allowedExtensions = fileBox.dataset.allowedExtensions.split(',').map(ext => ext.replace(/^([^.])/, '.$1'))\n        input.setAttribute('accept', allowedExtensions.join(','))\n      }\n\n      fileBox.addEventListener('dragover', function (e) { onDragEnter(e, fileBox, input) }, false)\n      fileBox.addEventListener('dragenter', function (e) { onDragEnter(e, fileBox, input) }, false)\n      fileBox.addEventListener('dragleave', function (e) { onDragLeave(e, fileBox, input) }, false)\n      fileBox.addEventListener('drop', function (e) { onDrop(e, fileBox, input) }, false)\n\n      input.addEventListener('change', function (e) { onChange(e, fileBox, input) }, false)\n      input.addEventListener('focus', function (e) { onFocus(e, fileBox) }, false)\n      input.addEventListener('blur', function (e) { onBlur(e, fileBox) }, false)\n\n      if (form) {\n        if (fileBox.dataset.autoSubmit && fileBox.dataset.autoSubmit.toLowerCase() !== 'false') {\n          input.addEventListener('change', function (e) { form.submit() }, false)\n        }\n\n        form.addEventListener('reset', function (e) { onReset(e, fileBox, input) }, false)\n        form.addEventListener('submit', function (e) { onSubmit(e, fileBox) }, false)\n      }\n\n      onChange(new Event('change'), fileBox, input)\n    })(elements[i])\n  }\n\n  window.addEventListener('dragover', function (e) { onWindowDragOver(e) }, false)\n  window.addEventListener('drop', function (e) { onWindowDrop(e) }, false)\n\n  return elements\n}\n\nfilebokz.addFiles = (input, files) => {\n  const filesArr = Array.from(input.files)\n\n  filesArr.concat(Array.from(files))\n  input.files = filebokz.newFileList(filesArr)\n\n  filebokz.triggerEvent('change', input)\n}\n\nfilebokz.newFileList = (files) => {\n  let dt\n\n  try {\n    dt = new DataTransfer()\n  } catch (e) {\n    dt = new ClipboardEvent('')\n  }\n\n  for (let i = 0; i < files.length; i++) {\n    dt.items.add(files[i])\n  }\n\n  return dt.files\n}\n\nfilebokz.removeFiles = (input, index, count) => {\n  const filesArr = Array.from(input.files)\n\n  filesArr.splice(index || 0, count || 1)\n  input.files = filebokz.newFileList(filesArr)\n\n  filebokz.triggerEvent('change', input, { filebokzAction: 'remove' })\n}\n\nfilebokz.triggerEvent = (type, element, data, delay) => {\n  return setTimeout(function () {\n    const e = new Event(type)\n\n    for (const key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) e[key] = data[key]\n    }\n\n    element.dispatchEvent(e)\n  }, delay || 1)\n}\n\nexport default filebokz\n"],"names":["filebokz","elements","applyClass","imageTypes","sizeUnits","div","document","createElement","draggable","advanced","window","count","querySelectorAll","HTMLElement","displayErrorMessage","fileBox","errorType","variable","element","querySelector","errorDisplayDuration","dataset","classList","add","fileBoxData","message","maxFilesErrorMsg","replace","maxFileSizeErrorMsg","fileSize","maxSizeErrorMsg","allowedExtensionsErrorMsg","innerHTML","errorAnimationDuration","Object","prototype","hasOwnProperty","call","setTimeout","remove","triggerEvent","errorMessage","fileAttribute","attributes","attrPrefix","typePrefix","typeKey","bytes","Math","abs","u","round","length","toFixed","onBlur","e","onChange","input","files","originalFiles","removing","filebokzAction","appendable","toLowerCase","multiple","hasAttribute","getAttribute","filesArr","Array","from","newFilesArr","i","duplicateFound","k","lastModifed","name","size","type","push","newFileList","validateFiles","fileCount","fileCountElement","s","sizeElement","filesElement","filesElementData","fileElements","fe","removeChild","draggableFiles","f","file","index","split","c","toUpperCase","charAt","slice","content","contentBefore","contentAfter","url","includes","URL","createObjectURL","fileElement","className","addEventListener","onFileDrag","id","onFileDragStart","removeElement","onFileRemoveClick","append","onDragEnter","preventDefault","stopPropagation","onDragLeave","onDrop","dataTransfer","oldFileBoxId","getData","oldFileIndex","oldFileBox","getElementById","oldInput","oldFileElement","children","oldFilesArr","splice","fileBoxId","overElement","elementFromPoint","pageX","pageY","newFileBox","closest","contains","target","fileIndex","parentNode","indexOf","setData","removeFiles","onFocus","onReset","error","onSubmit","onWindowDragOver","onWindowDrop","stopImmediatePropagation","fileList","maxFiles","maxFileSize","maxSize","allowedExtensions","map","ext","pop","join","form","filebokzId","setAttribute","autoSubmit","submit","Event","addFiles","concat","dt","DataTransfer","ClipboardEvent","items","data","delay","key","dispatchEvent"],"mappings":"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"}