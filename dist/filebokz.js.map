{"version":3,"file":"filebokz.js","sources":["../src/filebokz.js"],"sourcesContent":["/*!\n  filebokz v0.1.2 (https://github.com/kodie/filebokz)\n  by Kodie Grantham (https://kodieg.com)\n*/\n\nconst filebokz = (elements, applyClass) => {\n  if (!elements) elements = '.filebokz'\n  if (typeof applyClass !== 'string') applyClass = 'filebokz'\n\n  const imageTypes = ['apng', 'bmp', 'gif', 'x-icon', 'jpeg', 'png', 'svg+xml', 'tiff', 'webp']\n  const sizeUnits = ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n  const div = document.createElement('div')\n  const draggable = ('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)\n  const advanced = ('FormData' in window && 'FileReader' in window)\n\n  if (!filebokz.count) filebokz.count = 0\n\n  if (typeof elements === 'string') {\n    elements = document.querySelectorAll(elements)\n  } else if (elements instanceof HTMLElement) {\n    elements = [elements]\n  }\n\n  const displayErrorMessage = (fileBox, errorType, variable) => {\n    const element = fileBox.querySelector('.error-msg')\n    const errorDisplayDuration = fileBox.dataset.errorDisplayDuration || 3000\n\n    fileBox.classList.add('error')\n\n    const fileBoxData = fileBox.dataset\n    let message = ''\n\n    if (errorType === 'maxFiles') {\n      message = fileBoxData.maxFilesErrorMsg || 'A maximum of {variable} file{s} can be uploaded.'\n      message = message.replace(/{variable}/ig, variable)\n      message = message.replace(/{s}/ig, (variable > 1) ? 's' : '')\n    }\n\n    if (errorType === 'maxFileSize') {\n      message = fileBoxData.maxFileSizeErrorMsg || 'File size cannot exceed {variable}.'\n      message = message.replace(/{variable}/ig, fileSize(variable))\n    }\n\n    if (errorType === 'maxSize') {\n      message = fileBoxData.maxSizeErrorMsg || 'Total combined file size cannot exceed {variable}.'\n      message = message.replace(/{variable}/ig, fileSize(variable))\n    }\n\n    if (errorType === 'allowedExtensions') {\n      message = fileBoxData.allowedExtensionsErrorMsg || 'Only the following file types are allowed: {variable}.'\n      message = message.replace(/{variable}/ig, variable)\n    }\n\n    if (element) {\n      element.innerHTML = message\n\n      let errorAnimationDuration = 250\n      if (Object.prototype.hasOwnProperty.call(fileBox.dataset, 'errorAnimationDuration')) {\n        errorAnimationDuration = fileBox.dataset.errorAnimationDuration\n      }\n\n      setTimeout(function () {\n        element.innerHTML = ''\n      }, errorDisplayDuration + errorAnimationDuration)\n    }\n\n    setTimeout(function () {\n      fileBox.classList.remove('error')\n    }, errorDisplayDuration)\n\n    filebokz.triggerEvent('error', fileBox, {\n      errorMessage: message,\n      errorType: errorType\n    })\n  }\n\n  const fileAttribute = (attributes, attrPrefix, typePrefix, typeKey) => {\n    if (Object.prototype.hasOwnProperty.call(attributes, attrPrefix + typeKey)) {\n      return attributes[attrPrefix + typeKey]\n    } else if (Object.prototype.hasOwnProperty.call(attributes, attrPrefix + typePrefix)) {\n      return attributes[attrPrefix + typePrefix]\n    }\n  }\n\n  const fileSize = (bytes) => {\n    if (Math.abs(bytes) < 1024) return bytes + ' B'\n\n    let u = -1\n\n    do {\n      bytes /= 1024\n      ++u\n    } while (Math.round(Math.abs(bytes) * 10) / 10 >= 1024 && u < sizeUnits.length - 1)\n\n    return +bytes.toFixed(1) + ' ' + sizeUnits[u]\n  }\n\n  const onBlur = (e, fileBox) => {\n    fileBox.classList.remove('in-focus')\n  }\n\n  const onChange = (e, fileBox, input) => {\n    let files = input.files\n    const originalFiles = input.originalFiles || []\n    const removing = e.filebokzAction === 'remove'\n\n    if (files.length) {\n      const appendable = !fileBox.dataset.appendable || fileBox.dataset.appendable.toLowerCase() !== 'false'\n      const multiple = input.hasAttribute('multiple') && input.getAttribute('multiple').toLowerCase() !== 'false'\n\n      if (appendable && multiple && !removing && originalFiles.length) {\n        const filesArr = Array.from(files)\n        const newFilesArr = Array.from(originalFiles)\n\n        for (let i = 0; i < filesArr.length; i++) {\n          let duplicateFound = false\n\n          for (let k = 0; k < newFilesArr.length; k++) {\n            if (\n              filesArr[i].lastModifed === newFilesArr[k].lastModifed &&\n              filesArr[i].name === newFilesArr[k].name &&\n              filesArr[i].size === newFilesArr[k].size &&\n              filesArr[i].type === newFilesArr[k].type\n            ) duplicateFound = true\n          }\n\n          if (!duplicateFound) newFilesArr.push(filesArr[i])\n        }\n\n        input.files = filebokz.newFileList(newFilesArr)\n        files = input.files\n      }\n\n      if (validateFiles(files, fileBox, input)) {\n        fileBox.classList.add('has-files')\n      } else {\n        files = []\n      }\n    }\n\n    if (!files.length && !removing) {\n      input.files = filebokz.newFileList(originalFiles)\n      files = input.files\n    }\n\n    if (!files.length) {\n      fileBox.classList.remove('has-files')\n    }\n\n    input.originalFiles = files\n    fileBox.dataset.fileCount = files.length\n\n    const fileCountElement = fileBox.querySelector('.file-count')\n    if (fileCountElement) fileCountElement.innerHTML = files.length\n\n    let size = 0\n    for (let s = 0; s < files.length; s++) {\n      size += files[s].size\n    }\n\n    fileBox.dataset.size = size\n\n    const sizeElement = fileBox.querySelector('.size')\n    if (sizeElement) sizeElement.innerHTML = fileSize(size)\n\n    const filesElement = fileBox.querySelector('.files')\n    if (filesElement) {\n      const filesElementData = filesElement.dataset\n\n      const fileElements = filesElement.querySelectorAll('.file')\n      if (fileElements) {\n        for (let fe = 0; fe < fileElements.length; fe++) {\n          filesElement.removeChild(fileElements[fe])\n        }\n      }\n\n      if (files.length) {\n        const draggableFiles = !filesElementData.draggable || filesElementData.draggable.toLowerCase() !== 'false'\n\n        for (let f = 0; f < files.length; f++) {\n          (function (file, index) {\n            let typePrefix = file.type.split('/')[0]\n            const typeKey = file.type\n              .replace(/[/+-](\\w{1})/g, function (c) { return c.toUpperCase() })\n              .replace(/[/+-]/g, '')\n\n            typePrefix = typePrefix.charAt(0).toUpperCase() + typePrefix.slice(1)\n\n            let element = fileAttribute(filesElementData, 'element', typePrefix, typeKey)\n            element = element || filesElementData.element || 'span'\n\n            let content = fileAttribute(filesElementData, 'content', typePrefix, typeKey)\n            content = content || filesElementData.content || '{name}'\n\n            let contentBefore = fileAttribute(filesElementData, 'contentBefore', typePrefix, typeKey)\n            contentBefore = contentBefore || filesElementData.contentBefore || ''\n\n            let contentAfter = fileAttribute(filesElementData, 'contentAfter', typePrefix, typeKey)\n            contentAfter = contentAfter || filesElementData.contentAfter || ''\n\n            let url = fileAttribute(filesElementData, 'url', typePrefix, typeKey)\n\n            if (!url) {\n              if (imageTypes.includes(file.type.replace('image/', ''))) {\n                url = window.URL.createObjectURL(file)\n              } else {\n                url = filesElementData.url || ''\n              }\n            }\n\n            content = contentBefore + content + contentAfter\n            content = content.replace(/{name}/ig, file.name)\n            content = content.replace(/{type}/ig, file.type)\n            content = content.replace(/{size}/ig, fileSize(file.size))\n            content = content.replace(/{url}/ig, url)\n\n            const fileElement = document.createElement(element)\n\n            fileElement.className = 'file'\n            fileElement.innerHTML = content\n\n            if (draggable && draggableFiles) {\n              fileElement.draggable = 'true'\n              fileElement.addEventListener('drag', function (e) { onFileDrag(e, fileBox.id) }, false)\n              fileElement.addEventListener('dragstart', function (e) { onFileDragStart(e, fileBox.id) }, false)\n            }\n\n            const removeElement = fileElement.querySelector('.remove')\n            if (removeElement) {\n              removeElement.addEventListener('click', function (e) { onFileRemoveClick(e, input, index) }, false)\n            }\n\n            filesElement.append(fileElement)\n          })(files[f], f)\n        }\n      }\n    }\n\n    if (files.length > originalFiles.length) {\n      filebokz.triggerEvent('file-added', fileBox)\n    } else if (files.length < originalFiles.length) {\n      filebokz.triggerEvent('file-removed', fileBox)\n    }\n  }\n\n  const onDragEnter = (e, fileBox, input) => {\n    e.preventDefault()\n    e.stopPropagation()\n    fileBox.classList.add('is-dragging')\n  }\n\n  const onDragLeave = (e, fileBox) => {\n    e.preventDefault()\n    e.stopPropagation()\n    fileBox.classList.remove('is-dragging')\n  }\n\n  const onDrop = (e, fileBox, input) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    fileBox.classList.remove('is-dragging')\n\n    let files = e.dataTransfer.files\n    const oldFileBoxId = e.dataTransfer.getData('fileBoxId')\n\n    if (oldFileBoxId) {\n      const oldFileIndex = e.dataTransfer.getData('fileIndex')\n      const oldFileBox = document.getElementById(oldFileBoxId)\n      const oldInput = oldFileBox.querySelector('input')\n      const oldFileElement = oldFileBox.querySelector('.files').children[oldFileIndex]\n\n      oldFileBox.classList.remove('is-dragging')\n      oldFileBox.classList.remove('is-removing')\n      oldFileBox.classList.remove('is-transferring')\n      oldFileElement.classList.remove('is-dragging')\n      oldFileElement.classList.remove('is-removing')\n      oldFileElement.classList.remove('is-transferring')\n\n      if (oldFileBoxId === fileBox.id) return\n\n      const oldFilesArr = Array.from(oldInput.files)\n      const file = oldFilesArr[oldFileIndex]\n      let filesArr = Array.from(input.files)\n      const multiple = input.hasAttribute('multiple') && input.getAttribute('multiple').toLowerCase() !== 'false'\n\n      if (multiple) {\n        filesArr.push(file)\n      } else {\n        filesArr = [file]\n      }\n\n      if (validateFiles(filesArr, fileBox, input)) {\n        files = filebokz.newFileList(filesArr)\n\n        oldFilesArr.splice(oldFileIndex, 1)\n        oldInput.files = filebokz.newFileList(oldFilesArr)\n\n        filebokz.triggerEvent('change', oldInput, { filebokzAction: 'remove' })\n      }\n    }\n\n    if (files && files.length) {\n      input.files = files\n      filebokz.triggerEvent('change', input)\n    }\n  }\n\n  const onFileDrag = (e, fileBoxId) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    const overElement = document.elementFromPoint(e.pageX, e.pageY)\n\n    if (overElement) {\n      const fileBox = document.getElementById(fileBoxId)\n      const newFileBox = overElement.closest('[filebokz-id]')\n\n      if (newFileBox && newFileBox.classList.contains('js-enabled')) {\n        if (newFileBox.id !== fileBoxId) {\n          e.target.classList.add('is-transferring')\n          fileBox.classList.add('is-transferring')\n        }\n\n        e.target.classList.remove('is-removing')\n        fileBox.classList.remove('is-removing')\n      } else {\n        e.target.classList.add('is-removing')\n        fileBox.classList.add('is-removing')\n        e.target.classList.remove('is-transferring')\n        fileBox.classList.remove('is-transferring')\n      }\n    }\n  }\n\n  const onFileDragStart = (e, fileBoxId, index) => {\n    e.target.classList.add('is-dragging')\n\n    const fileIndex = Array.from(e.target.parentNode.children).indexOf(e.target)\n\n    e.dataTransfer.setData('fileBoxId', fileBoxId)\n    e.dataTransfer.setData('fileIndex', fileIndex)\n  }\n\n  const onFileRemoveClick = (e, input, index) => {\n    e.preventDefault()\n    e.stopPropagation()\n    filebokz.removeFiles(input, index)\n  }\n\n  const onFocus = (e, fileBox) => {\n    fileBox.classList.add('in-focus')\n  }\n\n  const onReset = (e, fileBox, input) => {\n    const error = fileBox.querySelector('.error')\n    if (error) error.innerHTML = ''\n\n    fileBox.classList.remove('error')\n\n    filebokz.triggerEvent('change', input)\n  }\n\n  const onSubmit = (e, fileBox) => {\n    fileBox.classList.add('is-uploading')\n  }\n\n  const onWindowDragOver = (e) => {\n    e.preventDefault()\n  }\n\n  const onWindowDrop = (e) => {\n    e.preventDefault()\n    e.stopImmediatePropagation()\n\n    const fileBoxId = e.dataTransfer.getData('fileBoxId')\n\n    if (fileBoxId) {\n      const fileBox = document.getElementById(fileBoxId)\n      const input = fileBox.querySelector('input')\n      const index = e.dataTransfer.getData('fileIndex')\n\n      filebokz.removeFiles(input, index)\n    }\n  }\n\n  const validateFiles = (fileList, fileBox, input) => {\n    const fileBoxData = fileBox.dataset\n    const multiple = input.hasAttribute('multiple') && input.getAttribute('multiple').toLowerCase() !== 'false'\n    const maxFiles = !multiple ? 1 : Object.prototype.hasOwnProperty.call(fileBoxData, 'maxFiles') ? fileBoxData.maxFiles : null\n    const maxFileSize = fileBoxData.maxFileSize\n    const maxSize = fileBoxData.maxSize\n    const allowedExtensions = fileBoxData.allowedExtensions ? fileBoxData.allowedExtensions.split(',').map(ext => ext.replace(/^(\\.)/, '')) : null\n    let size = 0\n\n    if (maxFiles && fileList.length > maxFiles) {\n      displayErrorMessage(fileBox, 'maxFiles', maxFiles)\n      return false\n    }\n\n    for (let i = 0; i < fileList.length; i++) {\n      let ext = fileList[i].name.split('.')\n\n      if (ext) {\n        ext = ext.pop().toLowerCase()\n      } else {\n        ext = '[none]'\n      }\n\n      size += fileList[i].size\n\n      if (maxFileSize && fileList[i].size > maxFileSize) {\n        displayErrorMessage(fileBox, 'maxFileSize', maxFileSize)\n        return false\n      }\n\n      if (maxSize && size > maxSize) {\n        displayErrorMessage(fileBox, 'maxSize', maxSize)\n        return false\n      }\n\n      if (allowedExtensions && !allowedExtensions.includes(ext)) {\n        displayErrorMessage(fileBox, 'allowedExtensions', allowedExtensions.join(', '))\n        return false\n      }\n    }\n\n    return true\n  }\n\n  for (let i = 0; i < elements.length; i++) {\n    (function (fileBox) {\n      const form = fileBox.closest('form')\n      const input = fileBox.querySelector('input[type=\"file\"]')\n\n      if (!input || fileBox.classList.contains('no-js') || Object.prototype.hasOwnProperty.call(fileBox.dataset, 'filebokzId')) return\n\n      filebokz.count++\n\n      fileBox.dataset.filebokzId = filebokz.count\n      fileBox.classList.add('js-enabled')\n\n      if (applyClass && !fileBox.classList.contains(applyClass)) fileBox.classList.add(applyClass)\n      if (advanced) fileBox.classList.add('is-advanced')\n      if (draggable) fileBox.classList.add('is-draggable')\n      if (!fileBox.id) fileBox.id = 'filebokz-' + filebokz.count\n\n      if (fileBox.dataset.allowedExtensions && !input.getAttribute('accept')) {\n        const allowedExtensions = fileBox.dataset.allowedExtensions.split(',').map(ext => ext.replace(/^([^.])/, '.$1'))\n        input.setAttribute('accept', allowedExtensions.join(','))\n      }\n\n      fileBox.addEventListener('dragover', function (e) { onDragEnter(e, fileBox, input) }, false)\n      fileBox.addEventListener('dragenter', function (e) { onDragEnter(e, fileBox, input) }, false)\n      fileBox.addEventListener('dragleave', function (e) { onDragLeave(e, fileBox, input) }, false)\n      fileBox.addEventListener('drop', function (e) { onDrop(e, fileBox, input) }, false)\n\n      input.addEventListener('change', function (e) { onChange(e, fileBox, input) }, false)\n      input.addEventListener('focus', function (e) { onFocus(e, fileBox) }, false)\n      input.addEventListener('blur', function (e) { onBlur(e, fileBox) }, false)\n\n      if (form) {\n        if (fileBox.dataset.autoSubmit && fileBox.dataset.autoSubmit.toLowerCase() !== 'false') {\n          input.addEventListener('change', function (e) { form.submit() }, false)\n        }\n\n        form.addEventListener('reset', function (e) { onReset(e, fileBox, input) }, false)\n        form.addEventListener('submit', function (e) { onSubmit(e, fileBox) }, false)\n      }\n\n      onChange(new Event('change'), fileBox, input)\n    })(elements[i])\n  }\n\n  window.addEventListener('dragover', function (e) { onWindowDragOver(e) }, false)\n  window.addEventListener('drop', function (e) { onWindowDrop(e) }, false)\n\n  return elements\n}\n\nfilebokz.addFiles = (input, files) => {\n  const filesArr = Array.from(input.files)\n\n  filesArr.concat(Array.from(files))\n  input.files = filebokz.newFileList(filesArr)\n\n  filebokz.triggerEvent('change', input)\n}\n\nfilebokz.newFileList = (files) => {\n  let dt\n\n  try {\n    dt = new DataTransfer()\n  } catch (e) {\n    dt = new ClipboardEvent('')\n  }\n\n  for (let i = 0; i < files.length; i++) {\n    dt.items.add(files[i])\n  }\n\n  return dt.files\n}\n\nfilebokz.removeFiles = (input, index, count) => {\n  const filesArr = Array.from(input.files)\n\n  filesArr.splice(index || 0, count || 1)\n  input.files = filebokz.newFileList(filesArr)\n\n  filebokz.triggerEvent('change', input, { filebokzAction: 'remove' })\n}\n\nfilebokz.triggerEvent = (type, element, data, delay) => {\n  return setTimeout(function () {\n    const e = new Event(type)\n\n    for (const key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) e[key] = data[key]\n    }\n\n    element.dispatchEvent(e)\n  }, delay || 1)\n}\n\nexport default filebokz\n"],"names":["filebokz","elements","applyClass","imageTypes","sizeUnits","div","document","createElement","draggable","advanced","window","count","querySelectorAll","HTMLElement","displayErrorMessage","fileBox","errorType","variable","element","querySelector","errorDisplayDuration","dataset","classList","add","fileBoxData","message","maxFilesErrorMsg","replace","maxFileSizeErrorMsg","fileSize","maxSizeErrorMsg","allowedExtensionsErrorMsg","innerHTML","errorAnimationDuration","Object","prototype","hasOwnProperty","call","setTimeout","remove","triggerEvent","errorMessage","fileAttribute","attributes","attrPrefix","typePrefix","typeKey","bytes","Math","abs","u","round","length","toFixed","onBlur","e","onChange","input","files","originalFiles","removing","filebokzAction","appendable","toLowerCase","multiple","hasAttribute","getAttribute","filesArr","Array","from","newFilesArr","i","duplicateFound","k","lastModifed","name","size","type","push","newFileList","validateFiles","fileCount","fileCountElement","s","sizeElement","filesElement","filesElementData","fileElements","fe","removeChild","draggableFiles","f","file","index","split","c","toUpperCase","charAt","slice","content","contentBefore","contentAfter","url","includes","URL","createObjectURL","fileElement","className","addEventListener","onFileDrag","id","onFileDragStart","removeElement","onFileRemoveClick","append","onDragEnter","preventDefault","stopPropagation","onDragLeave","onDrop","dataTransfer","oldFileBoxId","getData","oldFileIndex","oldFileBox","getElementById","oldInput","oldFileElement","children","oldFilesArr","splice","fileBoxId","overElement","elementFromPoint","pageX","pageY","newFileBox","closest","contains","target","fileIndex","parentNode","indexOf","setData","removeFiles","onFocus","onReset","error","onSubmit","onWindowDragOver","onWindowDrop","stopImmediatePropagation","fileList","maxFiles","maxFileSize","maxSize","allowedExtensions","map","ext","pop","join","form","filebokzId","setAttribute","autoSubmit","submit","Event","addFiles","concat","dt","DataTransfer","ClipboardEvent","items","data","delay","key","dispatchEvent"],"mappings":"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"}