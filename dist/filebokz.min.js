((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).filebokz=t()})(this,function(){function S(e,r){e=e||".filebokz","string"!=typeof r&&(r="filebokz");for(var y=["apng","bmp","gif","x-icon","jpeg","png","svg+xml","tiff","webp"],a=["kB","MB","GB","TB","PB","EB","ZB","YB"],t=document.createElement("div"),E=("draggable"in t||"ondragstart"in t&&"ondrop"in t),i=("FormData"in window&&"FileReader"in window),c=(S.count||(S.count=0),"string"==typeof e?e=document.querySelectorAll(e):e instanceof HTMLElement&&(e=[e]),function(e,t,r){var a=e.querySelector(".error-msg"),i=e.dataset.errorDisplayDuration||3e3,n=(e.classList.add("error"),e.dataset),s="";"maxFiles"===t&&(s=(s=(s=n.maxFilesErrorMsg||"A maximum of {variable} file{s} can be uploaded.").replace(/{variable}/gi,r)).replace(/{s}/gi,1<r?"s":"")),"maxFileSize"===t&&(s=(s=n.maxFileSizeErrorMsg||"File size cannot exceed {variable}.").replace(/{variable}/gi,x(r))),"maxSize"===t&&(s=(s=n.maxSizeErrorMsg||"Total combined file size cannot exceed {variable}.").replace(/{variable}/gi,x(r))),"allowedExtensions"===t&&(s=(s=n.allowedExtensionsErrorMsg||"Only the following file types are allowed: {variable}.").replace(/{variable}/gi,r)),a&&(a.innerHTML=s,n=250,Object.prototype.hasOwnProperty.call(e.dataset,"errorAnimationDuration")&&(n=e.dataset.errorAnimationDuration),setTimeout(function(){a.innerHTML=""},i+n)),setTimeout(function(){e.classList.remove("error")},i),S.triggerEvent("error",e,{errorMessage:s,errorType:t})}),w=function(e,t,r,a){return Object.prototype.hasOwnProperty.call(e,t+a)?e[t+a]:Object.prototype.hasOwnProperty.call(e,t+r)?e[t+r]:void 0},x=function(e){if(Math.abs(e)<1024)return e+" B";for(var t=-1;e/=1024,++t,1024<=Math.round(10*Math.abs(e))/10&&t<a.length-1;);return+e.toFixed(1)+" "+a[t]},n=function(e,l,d){var t=d.files,r=d.originalFiles||[],e="remove"===e.filebokzAction;if(t.length){var a=!l.dataset.appendable||"false"!==l.dataset.appendable.toLowerCase(),i=d.hasAttribute("multiple")&&"false"!==d.getAttribute("multiple").toLowerCase();if(a&&i&&!e&&r.length){for(var n=Array.from(t),s=Array.from(r),o=0;o<n.length;o++){for(var c=!1,f=0;f<s.length;f++)n[o].lastModifed===s[f].lastModifed&&n[o].name===s[f].name&&n[o].size===s[f].size&&n[o].type===s[f].type&&(c=!0);c||s.push(n[o])}d.files=S.newFileList(s),t=d.files}T(t,l,d)?l.classList.add("has-files"):t=[]}t.length||e||(d.files=S.newFileList(r),t=d.files),t.length||l.classList.remove("has-files"),d.originalFiles=t,l.dataset.fileCount=t.length;for(var a=l.querySelector(".file-count"),g=(a&&(a.innerHTML=t.length),0),u=0;u<t.length;u++)g+=t[u].size;l.dataset.size=g;var i=l.querySelector(".size"),p=(i&&(i.innerHTML=x(g)),l.querySelector(".files"));if(p){var v=p.dataset,m=p.querySelectorAll(".file");if(m)for(var L=0;L<m.length;L++)p.removeChild(m[L]);if(t.length)for(var b=!v.draggable||"false"!==v.draggable.toLowerCase(),h=0;h<t.length;h++)((e,t)=>{var r=e.type.split("/")[0],a=e.type.replace(/[/+-](\w{1})/g,function(e){return e.toUpperCase()}).replace(/[/+-]/g,""),r=r.charAt(0).toUpperCase()+r.slice(1),i=w(v,"element",r,a)||v.element||"span",n=(n=w(v,"content",r,a))||v.content||"{name}",s=w(v,"contentBefore",r,a)||v.contentBefore||"",o=w(v,"contentAfter",r,a)||v.contentAfter||"",r=(r=w(v,"url",r,a))||(y.includes(e.type.replace("image/",""))?window.URL.createObjectURL(e):v.url||"");n=(n=(n=(n=(n=s+n+o).replace(/{name}/gi,e.name)).replace(/{type}/gi,e.type)).replace(/{size}/gi,x(e.size))).replace(/{url}/gi,r),(a=document.createElement(i)).className="file",a.innerHTML=n,E&&b&&(a.draggable="true",a.addEventListener("drag",function(e){z(e,l.id)},!1),a.addEventListener("dragstart",function(e){A(e,l.id)},!1)),(s=a.querySelector(".remove"))&&s.addEventListener("click",function(e){F(e,d,t)},!1),p.append(a)})(t[h],h)}t.length>r.length?S.triggerEvent("file-added",l):t.length<r.length&&S.triggerEvent("file-removed",l)},s=function(e,t,r){e.preventDefault(),e.stopPropagation(),t.classList.add("is-dragging")},z=function(e,t){e.preventDefault(),e.stopPropagation();var r,a=document.elementFromPoint(e.pageX,e.pageY);a&&(r=document.getElementById(t),(a=a.closest("[filebokz-id]"))&&a.classList.contains("js-enabled")?(a.id!==t&&(e.target.classList.add("is-transferring"),r.classList.add("is-transferring")),e.target.classList.remove("is-removing"),r.classList.remove("is-removing")):(e.target.classList.add("is-removing"),r.classList.add("is-removing"),e.target.classList.remove("is-transferring"),r.classList.remove("is-transferring")))},A=function(e,t,r){e.target.classList.add("is-dragging");var a=Array.from(e.target.parentNode.children).indexOf(e.target);e.dataTransfer.setData("fileBoxId",t),e.dataTransfer.setData("fileIndex",a)},F=function(e,t,r){e.preventDefault(),e.stopPropagation(),S.removeFiles(t,r)},T=function(e,t,r){var a=t.dataset,r=r.hasAttribute("multiple")&&"false"!==r.getAttribute("multiple").toLowerCase()?Object.prototype.hasOwnProperty.call(a,"maxFiles")?a.maxFiles:null:1,i=a.maxFileSize,n=a.maxSize,s=a.allowedExtensions?a.allowedExtensions.split(",").map(function(e){return e.replace(/^(\.)/,"")}):null,o=0;if(r&&e.length>r)return c(t,"maxFiles",r),!1;for(var l=0;l<e.length;l++){var d=(d=e[l].name.split("."))?d.pop().toLowerCase():"[none]";if(o+=e[l].size,i&&e[l].size>i)return c(t,"maxFileSize",i),!1;if(n&&n<o)return c(t,"maxSize",n),!1;if(s&&!s.includes(d))return c(t,"allowedExtensions",s.join(", ")),!1}return!0},o=0;o<e.length;o++)(l=>{var e,t=l.closest("form"),d=l.querySelector('input[type="file"]');!d||l.classList.contains("no-js")||Object.prototype.hasOwnProperty.call(l.dataset,"filebokzId")||(S.count++,l.dataset.filebokzId=S.count,l.classList.add("js-enabled"),r&&!l.classList.contains(r)&&l.classList.add(r),i&&l.classList.add("is-advanced"),E&&l.classList.add("is-draggable"),l.id||(l.id="filebokz-"+S.count),l.dataset.allowedExtensions&&!d.getAttribute("accept")&&(e=l.dataset.allowedExtensions.split(",").map(function(e){return e.replace(/^([^.])/,".$1")}),d.setAttribute("accept",e.join(","))),l.addEventListener("dragover",function(e){s(e,l)},!1),l.addEventListener("dragenter",function(e){s(e,l)},!1),l.addEventListener("dragleave",function(e){var t;t=l,(e=e).preventDefault(),e.stopPropagation(),t.classList.remove("is-dragging")},!1),l.addEventListener("drop",function(e){var t=l,r=d,a=((e=e).preventDefault(),e.stopPropagation(),t.classList.remove("is-dragging"),e.dataTransfer.files),i=e.dataTransfer.getData("fileBoxId");if(i){var e=e.dataTransfer.getData("fileIndex"),n=document.getElementById(i),s=n.querySelector("input"),o=n.querySelector(".files").children[e];if(n.classList.remove("is-dragging"),n.classList.remove("is-removing"),n.classList.remove("is-transferring"),o.classList.remove("is-dragging"),o.classList.remove("is-removing"),o.classList.remove("is-transferring"),i===t.id)return;n=Array.from(s.files),o=n[e],i=Array.from(r.files);r.hasAttribute("multiple")&&"false"!==r.getAttribute("multiple").toLowerCase()?i.push(o):i=[o],T(i,t,r)&&(a=S.newFileList(i),n.splice(e,1),s.files=S.newFileList(n),S.triggerEvent("change",s,{filebokzAction:"remove"}))}a&&a.length&&(r.files=a,S.triggerEvent("change",r))},!1),d.addEventListener("change",function(e){n(e,l,d)},!1),d.addEventListener("focus",function(e){l.classList.add("in-focus")},!1),d.addEventListener("blur",function(e){l.classList.remove("in-focus")},!1),t&&(l.dataset.autoSubmit&&"false"!==l.dataset.autoSubmit.toLowerCase()&&d.addEventListener("change",function(e){t.submit()},!1),t.addEventListener("reset",function(e){var t,r,a;r=d,(a=(t=l).querySelector(".error"))&&(a.innerHTML=""),t.classList.remove("error"),S.triggerEvent("change",r)},!1),t.addEventListener("submit",function(e){l.classList.add("is-uploading")},!1)),n(new Event("change"),l,d))})(e[o]);return window.addEventListener("dragover",function(e){e.preventDefault()},!1),window.addEventListener("drop",function(e){var t;(e=e).preventDefault(),e.stopImmediatePropagation(),(t=e.dataTransfer.getData("fileBoxId"))&&(t=document.getElementById(t).querySelector("input"),e=e.dataTransfer.getData("fileIndex"),S.removeFiles(t,e))},!1),e}return S.addFiles=function(e,t){var r=Array.from(e.files);r.concat(Array.from(t)),e.files=S.newFileList(r),S.triggerEvent("change",e)},S.newFileList=function(e){var t;try{t=new DataTransfer}catch(e){t=new ClipboardEvent("")}for(var r=0;r<e.length;r++)t.items.add(e[r]);return t.files},S.removeFiles=function(e,t,r){var a=Array.from(e.files);a.splice(t||0,r||1),e.files=S.newFileList(a),S.triggerEvent("change",e,{filebokzAction:"remove"})},S.triggerEvent=function(r,a,i,e){return setTimeout(function(){var e,t=new Event(r);for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);a.dispatchEvent(t)},e||1)},S});
//# sourceMappingURL=filebokz.min.js.map